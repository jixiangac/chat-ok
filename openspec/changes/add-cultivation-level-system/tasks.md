## 1. 基础架构

- [ ] 1.1 定义修仙等级相关类型 (`src/pages/dc/types.ts`)
  - RealmType: 9 大境界枚举
  - StageType: 阶段枚举（初期/中期/后期/巅峰/大圆满 + 炼气层数）
  - CultivationData: 修炼数据接口
  - CultivationRecord: 修为记录接口
  - CultivationHistory: 历史记录接口

- [ ] 1.2 创建修为计算工具 (`src/pages/dc/utils/cultivationCalculator.ts`)
  - 境界修为范围计算函数
  - 境界判定函数（根据修为值返回境界）
  - 修为增减计算函数
  - 阶段进度百分比计算

- [ ] 1.3 创建境界常量配置 (`src/pages/dc/constants/cultivation.ts`)
  - 境界名称映射
  - 任务类型修为配置
  - 周期奖惩配置
  - 惩罚分档配置

## 2. 状态管理

- [ ] 2.1 创建 CultivationContext (`src/pages/dc/contexts/CultivationProvider/`)
  - CultivationProvider 组件
  - useCultivation hook
  - 修为数据读写方法
  - 闭关状态管理

- [ ] 2.2 实现数据持久化
  - 初始化逻辑（新用户炼气一层、修为 0）
  - 存储到 dc_user_data
  - 历史记录按周存储

- [ ] 2.3 实现修为变动方法
  - addExp(): 增加修为
  - deductExp(): 扣除修为
  - checkBreakthrough(): 检查是否可突破
  - breakthrough(): 执行突破
  - checkDemotion(): 检查是否需要降级
  - startSeclusion(): 开始闭关
  - checkSeclusionResult(): 检查闭关结果

## 3. 任务系统集成

- [ ] 3.1 任务打卡集成修为获取
  - 数值型任务打卡 → +10 修为
  - 清单型任务完成项 → +5 修为
  - 打卡型任务打卡 → +8 修为
  - 记录到历史

- [ ] 3.2 周期结算集成
  - 完成度 ≥30% → 发放奖励修为
  - 完成度 100% → 额外 +20% 加成
  - 完成度 <30% → 扣除修为（按境界分档）
  - 记录到历史

- [ ] 3.3 闭关状态检查
  - 每日检查闭关是否到期
  - 到期后判定成功/失败
  - 失败执行降级

## 4. 修炼面板 UI

- [ ] 4.1 创建修炼面板组件 (`src/pages/dc/panels/cultivation/`)
  - CultivationPanel 主组件
  - 全屏覆盖布局
  - 进入/退出动画

- [ ] 4.2 面板内容区域
  - 顶部：境界名称 + 阶段显示
  - 中部：角色/意象展示区
  - 下部：修为进度条 + 数值
  - 底部：详情/突破按钮

- [ ] 4.3 使用 ui-ux-pro-max 打磨
  - 参考图1图2布局
  - 参考图3简约质感
  - 浅色背景 + 圆角卡片
  - 流畅动画交互

- [ ] 4.4 主页下拉触发集成
  - 监听下拉距离
  - 超过阈值显示面板
  - 手势交互优化

## 5. 突破与降级

- [ ] 5.1 突破功能
  - 突破按钮（修为满时显示）
  - 突破确认交互
  - 更新境界数据

- [ ] 5.2 降级逻辑
  - 小阶段直接降级
  - 跨大境界触发闭关
  - 闭关失败后降级

## 6. 历史记录

- [ ] 6.1 修为历史存储
  - 按周分 key 存储
  - 记录类型、数量、来源
  - 定期清理旧数据（保留 12 周）

- [ ] 6.2 历史查看入口（可选，后续迭代）
  - 历史列表展示
  - 按周筛选

## 7. 验证与测试

- [ ] 7.1 手动测试用例
  - 新用户初始化
  - 打卡获得修为
  - 周期结算奖惩
  - 突破晋升
  - 降级与闭关保护

- [ ] 7.2 边界情况验证
  - 修为不会负数
  - 最高境界处理
  - 最低境界处理
  - 闭关期间的各种操作
