# Implementation Tasks

## 1. 标签体系重构

### 1.1 类型定义更新
- [x] 1.1.1 在 `types.ts` 中新增 `TagType` 类型（'normal' | 'location' | 'mood'）
- [x] 1.1.2 更新 `TaskTag` 接口，添加 `type` 和 `icon` 字段
- [x] 1.1.3 新增 `TaskTags` 接口，包含 `normalTagId`、`locationTagId`、`moodTagId`
- [x] 1.1.4 更新 `Task` 接口，将 `tagId` 替换为 `tags: TaskTags`

### 1.2 标签存储重构
- [x] 1.2.1 重构 `tagStorage.ts`，支持按类型存储和查询标签
- [x] 1.2.2 实现标签数据迁移逻辑（现有标签迁移为普通标签）
- [x] 1.2.3 实现删除标签时的任务关联清理逻辑
- [x] 1.2.4 添加标签类型对应的图标配置

### 1.3 标签设置页面
- [x] 1.3.1 创建 `TagSettingsPanel` 组件
- [x] 1.3.2 实现 Tab 切换（普通/地点/心情）
- [x] 1.3.3 实现标签列表展示（图标+名称+颜色）
- [x] 1.3.4 实现添加标签功能
- [x] 1.3.5 实现删除标签功能（带确认提示）
- [x] 1.3.6 在设置面板中添加"标签设置"入口

## 2. 任务编辑支持多类型标签

### 2.1 TagSelector 组件重构
- [x] 2.1.1 重构 `TagSelector` 组件，支持多类型标签选择
- [x] 2.1.2 实现 Tab 切换展示三类标签
- [x] 2.1.3 移除组件内的新建标签功能（改为跳转设置页）

### 2.2 SidelineTaskEditModal 更新
- [x] 2.2.1 更新编辑弹窗，支持选择三类标签
- [x] 2.2.2 更新保存逻辑，处理 `tags` 对象

## 3. GroupModeGrid 优化

### 3.1 完成数量计算
- [x] 3.1.1 创建 `useTodayCompletion` hook，计算任务当日完成状态（复用现有 getTodayCheckInStatusForTask）
- [x] 3.1.2 实现打卡型任务的今日完成判断逻辑

### 3.2 GroupCard 更新
- [x] 3.2.1 在 `GroupCard` 组件中添加完成数量显示
- [x] 3.2.2 调整布局，在图标行右侧显示 "完成数/总数"

## 4. SidelineTaskSection 地点筛选

### 4.1 筛选逻辑
- [x] 4.1.1 创建 `useLocationFilter` hook，管理地点筛选状态（内联实现）
- [x] 4.1.2 实现获取支线任务中已使用的地点标签列表

### 4.2 UI 实现
- [x] 4.2.1 在 `SidelineTaskSection` 中添加地点筛选按钮
- [x] 4.2.2 实现筛选下拉菜单（全部 + 地点标签列表）
- [x] 4.2.3 在列表模式下应用筛选逻辑

## 5. 一日视图

### 5.1 DailyViewPopup 组件
- [x] 5.1.1 创建 `DailyViewPopup` 组件基础结构
- [x] 5.1.2 实现标题区域（一日清单 / TODAY'S LIST）
- [x] 5.1.3 实现日期信息和今日标语展示
- [x] 5.1.4 实现标签筛选功能
- [x] 5.1.5 实现上午/下午/晚上三个时段区块
- [x] 5.1.6 实现任务自动分配到时段的逻辑
- [x] 5.1.7 实现任务项展示（完成状态用删除线）
- [x] 5.1.8 实现点击任务打开详情页

### 5.2 TodayProgress 集成
- [x] 5.2.1 在 `TodayProgress` 组件中添加点击事件
- [x] 5.2.2 集成 `DailyViewPopup` 弹窗

## 6. 数据迁移与兼容

### 6.1 迁移脚本
- [x] 6.1.1 实现标签数据迁移（添加 type 字段）
- [x] 6.1.2 实现任务数据迁移（tagId → tags）
- [x] 6.1.3 在应用启动时自动执行迁移

## 7. 测试与验证

### 7.1 功能验证
- [ ] 7.1.1 验证标签创建、删除、编辑功能
- [ ] 7.1.2 验证任务标签选择功能
- [ ] 7.1.3 验证 GroupModeGrid 完成数量显示
- [ ] 7.1.4 验证地点筛选功能
- [ ] 7.1.5 验证一日视图功能
- [ ] 7.1.6 验证数据迁移兼容性
