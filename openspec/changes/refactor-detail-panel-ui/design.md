# Design: 任务详情页 UI 重构

## Context

当前详情页使用多 Tab 设计，信息分散，用户需要频繁切换才能完成核心操作。本次重构旨在简化交互流程，采用单屏聚焦设计，并引入具象化视觉隐喻提升用户体验。

## Goals / Non-Goals

### Goals
- 单屏展示核心信息，无需滚动或切换
- **以周期进度为核心呈现**，使用咖啡杯视觉隐喻
- 咖啡杯下方使用奶油风进度条展示今日进度
- 保持与设置面板、修仙界面一致的浅系简约风格
- 动画反馈增强操作满足感

### Non-Goals
- 不改变底层数据结构
- 不修改 TaskProvider 等上下文逻辑
- 不涉及归档、创建任务等其他功能

## Design System (UI/UX Pro Max)

### 设计风格选择

基于 UI/UX Pro Max 搜索结果，采用以下设计风格组合：

| 风格 | 应用场景 | 理由 |
|------|----------|------|
| **Soft UI Evolution** | 整体界面 | 改进的软 UI，更好的对比度，适合健康/习惯类应用 |
| **Neumorphism** | 咖啡杯容器 | 柔和的凸起效果，温暖舒适感 |
| **Liquid Glass** | 水杯/冰块 | 流动玻璃效果，适合液体视觉 |
| **Minimal & Direct** | 布局结构 | 简洁直接，快速加载 |

### 色系规范 (Coffee Shop Palette)

基于 Coffee Shop 色板，结合修仙界面背景色：

| 元素 | 颜色值 | CSS 变量 | 说明 |
|------|--------|----------|------|
| **页面背景** | `#F8FAFC` | `--bg-page` | 修仙界面背景色 |
| **卡片背景** | `#FFFFFF` | `--bg-card` | 纯白卡片 |
| **咖啡色（深）** | `#6F4E37` | `--coffee-dark` | 进度 100%，浓郁咖啡 |
| **咖啡色（中）** | `#8B7355` | `--coffee-medium` | 进度 50-99% |
| **咖啡色（浅）** | `#C4A484` | `--coffee-light` | 进度 < 50%，拿铁色 |
| **咖啡泡沫** | `#F5E6D3` | `--coffee-foam` | 泡沫层颜色 |
| **奶油白** | `#FFFEF5` | `--cream-light` | 奶油进度条填充 |
| **奶油米** | `#FFF8F0` | `--cream-bg` | 奶油进度条背景 |
| **水蓝色** | `#87CEEB` | `--water-blue` | 水杯填充 |
| **冰蓝色** | `#E0F4FF` | `--ice-blue` | 冰块颜色 |
| **主文字** | `#1E293B` | `--text-primary` | 深灰色 |
| **次要文字** | `#64748B` | `--text-secondary` | 中灰色 |
| **辅助文字** | `#94A3B8` | `--text-muted` | 浅灰色 |
| **CTA 按钮** | `#F97316` | `--cta-primary` | 温暖橙色 |

## Decisions

### 1. 视觉隐喻选择

| 任务类型 | 视觉隐喻 | 设计风格 | 理由 |
|---------|---------|----------|------|
| CHECK_IN | 咖啡杯水位 | Neumorphism + Soft UI | 温暖、舒适、习惯养成的隐喻 |
| NUMERIC 增加 | 透明水杯注水 | Liquid Glass | 清澈、流动、增长的视觉 |
| NUMERIC 减少 | 冰块融化 | Glassmorphism | 透明、渐变、减少的直观表达 |
| CHECKLIST | 清单列表 | Minimal & Direct | 清单本身就是最直观的展示 |

### 2. 咖啡杯进度组件设计 (CoffeeCupProgress)

```
┌─────────────────────────────────────┐
│           ～～～ (蒸汽动画)          │
│         ┌─────────┐                 │
│         │ ▓▓▓▓▓▓▓ │ ◗ (把手)        │
│         │ ▓▓▓▓▓▓▓ │                 │
│         │ ▓▓▓▓▓▓▓ │  ← 咖啡水位     │
│         │ ░░░░░░░ │     (周期进度)   │
│         │ ░░░░░░░ │                 │
│         └─────────┘                 │
│        ═══════════════ (杯底盘)      │
│                                     │
│         3/7 次  本周期进度           │
└─────────────────────────────────────┘
```

**视觉元素详细设计：**

| 元素 | 样式 | 尺寸 | 效果 |
|------|------|------|------|
| **杯身** | Neumorphism 凸起 | 120×140px | `box-shadow: -5px -5px 15px #fff, 5px 5px 15px rgba(0,0,0,0.1)` |
| **杯身内部** | 圆角矩形 | 100×120px | `border-radius: 8px 8px 16px 16px` |
| **咖啡液体** | 渐变填充 | 动态高度 | `linear-gradient(180deg, var(--coffee-foam) 0%, var(--coffee-*) 20%)` |
| **泡沫层** | 波浪边缘 | 8px 高度 | SVG 波浪 path，微妙动画 |
| **把手** | C 形曲线 | 30×50px | Neumorphism 阴影 |
| **杯底盘** | 椭圆形 | 140×20px | 浅灰色阴影 |
| **蒸汽** | 3 条曲线 | 各 40px 高 | 飘动动画，opacity 渐变 |

**咖啡颜色渐变规则：**
```css
/* 进度 0-30%: 浅咖啡 */
--coffee-fill: linear-gradient(180deg, #F5E6D3 0%, #C4A484 20%);

/* 进度 31-70%: 中咖啡 */
--coffee-fill: linear-gradient(180deg, #F5E6D3 0%, #8B7355 20%);

/* 进度 71-100%: 深咖啡 */
--coffee-fill: linear-gradient(180deg, #F5E6D3 0%, #6F4E37 20%);
```

### 3. 水杯进度组件设计 (WaterCupProgress)

```
┌─────────────────────────────────────┐
│         ┌─────────┐                 │
│         │ ░░░░░░░ │                 │
│         │ ▓▓▓▓▓▓▓ │  ← 水位         │
│         │ ▓▓▓▓▓▓▓ │     (周期进度)   │
│         │ ▓▓▓▓▓▓▓ │                 │
│         └─────────┘                 │
│                                     │
│         150/200 ml  本周期进度       │
└─────────────────────────────────────┘
```

**视觉元素详细设计：**

| 元素 | 样式 | 效果 |
|------|------|------|
| **杯身** | Glassmorphism 透明 | `background: rgba(255,255,255,0.3); backdrop-filter: blur(10px)` |
| **水液体** | 渐变蓝色 | `linear-gradient(180deg, #B8E0FF 0%, #87CEEB 100%)` |
| **水波纹** | 微妙波动 | CSS animation，2s 周期 |
| **气泡** | 小圆点上浮 | 随机位置，opacity 动画 |

### 4. 冰块融化组件设计 (IceMeltProgress)

```
┌─────────────────────────────────────┐
│                                     │
│         ┌───────────┐               │
│         │  ❄️ 冰块   │  ← 剩余量     │
│         │  (渐变)    │               │
│         └───────────┘               │
│         ～～～～～～～  ← 融化的水    │
│                                     │
│         剩余 50/100 kg              │
└─────────────────────────────────────┘
```

**视觉元素详细设计：**

| 元素 | 样式 | 效果 |
|------|------|------|
| **冰块** | 多边形 + Glassmorphism | `clip-path: polygon(...)` 不规则形状 |
| **冰块内部** | 渐变 + 纹理 | `linear-gradient(135deg, #E0F4FF 0%, #B8E0FF 50%, #87CEEB 100%)` |
| **裂纹** | SVG 线条 | 随进度增加裂纹数量 |
| **融化水** | 底部水滩 | 波浪动画，高度随进度增加 |
| **水滴** | 滴落动画 | 从冰块边缘滴落 |

### 5. 奶油风今日进度条设计 (TodayProgressBar)

```
┌─────────────────────────────────────┐
│ 今日进度                    1/1次   │
│ ┌─────────────────────────────────┐ │
│ │████████████████░░░░░░░░░░░░░░░░│ │
│ │ (奶油波浪)      (滴落效果)      │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**视觉元素详细设计：**

| 元素 | 样式 | 效果 |
|------|------|------|
| **进度条背景** | 圆角矩形 | `background: #FFF8F0; border-radius: 12px; height: 24px` |
| **奶油填充** | 渐变 + 波浪 | `linear-gradient(90deg, #FFFEF5, #FFF5E6)` |
| **波浪边缘** | SVG 波浪 | 填充区域右侧边缘，微妙波动动画 |
| **滴落效果** | 圆形 + 动画 | 进度条末端下方，滴落动画 |
| **完成状态** | 图标 + 文字 | ☕ 今日目标已达成 |

**波浪动画 CSS：**
```css
.cream-wave {
  animation: wave 1.5s ease-in-out infinite;
}

@keyframes wave {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(-5px); }
}
```

### 6. 组件架构

```
DetailPanel (主容器)
├── DetailHeader (顶部栏)
├── CycleProgressSection (周期进度区域 - 核心)
│   ├── CoffeeCupProgress (CHECK_IN)
│   │   ├── CupBody (杯身 + Neumorphism)
│   │   ├── CoffeeFill (咖啡液体 + 泡沫)
│   │   ├── CupHandle (把手)
│   │   ├── Saucer (杯底盘)
│   │   └── Steam (蒸汽动画)
│   ├── WaterCupProgress (NUMERIC 增加)
│   │   ├── GlassCup (透明杯身)
│   │   ├── WaterFill (水液体 + 波纹)
│   │   └── Bubbles (气泡)
│   ├── IceMeltProgress (NUMERIC 减少)
│   │   ├── IceBlock (冰块 + 裂纹)
│   │   ├── MeltedWater (融化水)
│   │   └── WaterDrops (水滴动画)
│   └── ChecklistProgress (CHECKLIST)
├── TodayProgressBar (今日进度 - 奶油风进度条)
│   ├── ProgressTrack (进度条背景)
│   ├── CreamFill (奶油填充 + 波浪)
│   └── CreamDrip (滴落效果)
├── CycleInfo (周期信息)
├── SecondaryNav (二级入口)
└── ActionButton (打卡按钮)
```

### 7. 页面布局（单屏，以周期为重点）

```
┌─────────────────────────────────────┐
│  顶部栏 (48px)                       │
│  - 返回按钮 | 任务标题 | 更多操作     │
├─────────────────────────────────────┤
│                                     │
│  周期进度区域 (flex: 1, 核心区域)     │
│  ┌─────────────────────────────┐    │
│  │                             │    │
│  │      ☕ 咖啡杯视觉元素        │    │
│  │      (Neumorphism 风格)      │    │
│  │                             │    │
│  │      3/7 次                 │    │
│  │      本周期进度              │    │
│  │                             │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 今日进度          1/1次     │    │
│  │ ████████████████░░░░░░░░░░ │    │
│  │ (奶油风进度条 + 波浪效果)    │    │
│  └─────────────────────────────┘    │
│                                     │
├─────────────────────────────────────┤
│  周期信息 (固定高度 60px)            │
│  - 第 3/5 周期 | 剩余 4 天           │
├─────────────────────────────────────┤
│  二级入口 (48px)                     │
│  - 📋 记录 | 📅 计划                 │
├─────────────────────────────────────┤
│  打卡按钮 (固定高度 80px)            │
│  - [立即打卡] CTA 橙色 #F97316       │
├─────────────────────────────────────┤
│  SafeArea                            │
└─────────────────────────────────────┘
```

### 8. 动画规范 (Motion-Driven)

基于 UI/UX Pro Max 动画指南：

| 动画 | 时长 | 缓动函数 | 触发时机 | 注意事项 |
|------|------|----------|----------|----------|
| 咖啡水位上升 | 600ms | ease-out | 打卡成功 | 使用 ease-out 进入 |
| 蒸汽飘动 | 2s | linear | 循环播放 | 仅用于装饰，非交互 |
| 奶油波浪 | 1.5s | ease-in-out | 循环播放 | 微妙效果，不分散注意力 |
| 奶油滴落 | 400ms | ease-in | 进度变化 | 使用 ease-in 退出 |
| 泡沫冒泡 | 1s | ease-in-out | 循环播放 | 随机延迟 |
| 水波纹 | 2s | ease-in-out | 循环播放 | 微妙效果 |
| 冰块裂纹 | 300ms | ease-out | 进度变化 | 配合震动反馈 |
| 水滴滴落 | 500ms | ease-in | 循环播放 | 随机间隔 |

**Reduced Motion 支持：**
```css
@media (prefers-reduced-motion: reduce) {
  .steam, .wave, .bubble, .drip {
    animation: none !important;
  }
}
```

## Risks / Trade-offs

| 风险 | 缓解措施 |
|------|----------|
| SVG 动画性能 | 使用 CSS transform/opacity，避免重绘 |
| 小屏幕适配 | 视觉元素响应式缩放，最小高度保证 |
| 组件复杂度 | 每个视觉组件独立，便于维护 |
| Neumorphism 对比度 | 采用 Soft UI Evolution，确保 WCAG AA |
| 动画过度 | 遵循 prefers-reduced-motion |

## Migration Plan

1. 保留现有组件，新建组件并行开发
2. 完成后替换主入口引用
3. 验证无误后清理废弃组件

## Open Questions

- [已解决] 冰块融化的 SVG 动画具体实现方式 → 使用 CSS 动画 + clip-path
- 咖啡杯的具体尺寸比例需要在实现时微调
- 是否需要添加触觉反馈（震动）配合动画
