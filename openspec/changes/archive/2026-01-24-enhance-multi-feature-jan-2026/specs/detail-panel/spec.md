## MODIFIED Requirements

### Requirement: CHECKLIST 类型 - 清单列表

系统 **SHALL** 为清单型任务展示可操作的当前周期清单列表，支持打勾完成、添加和延后操作。

#### Scenario: 清单页面布局

**GIVEN** 任务类型为 CHECKLIST
**WHEN** 显示详情页
**THEN** 显示：
- 不显示 WaterCupProgress 组件（无咖啡杯/水杯）
- 直接展示当前周期清单列表
- 标题行：「本周期清单 X/Y」
- 清单列表末尾：「+ 加入更多清单...」入口
- 保留 CycleInfo 周期进展卡片（与其他任务类型一致）

#### Scenario: 清单项布局

**GIVEN** 渲染清单列表
**WHEN** 显示每个清单项
**THEN**
- 已完成项：勾选状态 + 删除线 + 颜色变淡
- 未完成项：空勾选框 + 支持右滑操作
- 每项高度至少 48px，便于触控操作
- 勾选框点击区域足够大，避免误触

#### Scenario: 清单项周期分配逻辑

**GIVEN** 创建清单类型任务时设定了总清单数和总周期数
**WHEN** 系统分配清单项到各周期
**THEN** 默认平均分配到每个周期

#### Scenario: 未完成清单项延续

**GIVEN** 当前周期结束时有未完成的清单项
**WHEN** 进入下一周期
**THEN** 未完成项自动延续到下一周期
**And** 下一周期的清单项 = 延续项 + 原计划平均分配项

#### Scenario: 清单项打勾完成

**GIVEN** 用户点击未完成的清单项勾选框
**WHEN** 点击成功
**THEN** 
- 该项变为已完成状态
- 标题行进度更新
- 触发成功 Toast
- 发放相应奖励（如未超限）

#### Scenario: 清单项右滑操作

**GIVEN** 用户在未完成的清单项上左滑
**WHEN** 滑动距离超过阈值
**THEN** 显示「移到下周期」操作按钮（橙色背景）

#### Scenario: 清单项延后二次确认

**GIVEN** 用户点击「移到下周期」按钮
**WHEN** 弹窗打开
**THEN** 显示支线区域风格的确认弹窗
**And** 弹窗内容：
- 标题：「移到下周期」
- 描述：「『XXX』将移至下一周期」
- 提示：「本操作需消耗 2 灵玉」
- 按钮：「取消」、「确认 💎2」

#### Scenario: 确认延后操作

**GIVEN** 用户在确认弹窗点击「确认」
**WHEN** 用户灵玉余额 >= 2
**THEN** 
- 扣除 2 灵玉
- 该清单项从当前周期移除
- 标记为下一周期待完成
- 显示成功 Toast

#### Scenario: 延后灵玉不足

**GIVEN** 用户在确认弹窗点击「确认」
**WHEN** 用户灵玉余额 < 2
**THEN** 显示灵玉不足提示弹窗

#### Scenario: 加入更多清单项入口

**GIVEN** 用户点击「+ 加入更多清单...」
**WHEN** 弹窗打开
**THEN** 显示非当前周期、未完成的清单项列表
**And** 每项可点击加入（消耗 1 灵玉）

#### Scenario: 加入清单项到当前周期

**GIVEN** 用户在「加入更多」弹窗中点击某清单项
**WHEN** 用户灵玉余额 >= 1
**THEN**
- 弹出二次确认：「加入『XXX』到当前周期，消耗 1 灵玉」
- 确认后扣除 1 灵玉
- 该清单项添加到当前周期
- 弹窗列表更新
- 显示成功 Toast

#### Scenario: 加入时灵玉不足

**GIVEN** 用户在「加入更多」弹窗中点击某清单项
**WHEN** 用户灵玉余额 < 1
**THEN** 显示灵玉不足提示弹窗

---

## ADDED Requirements

### Requirement: 归档任务只读详情页

系统 **SHALL** 支持打开归档任务的完整详情页，采用只读模式展示。

#### Scenario: 打开归档任务详情

**GIVEN** 用户在归档列表页点击某个归档任务
**WHEN** 详情页打开
**THEN** 显示 GoalDetailModal
**And** 传入 isReadOnly=true

#### Scenario: 只读模式隐藏操作元素

**GIVEN** GoalDetailModal 以 isReadOnly=true 打开
**WHEN** 页面渲染
**THEN** 隐藏以下元素：
- 底部打卡/记录按钮
- 顶部更多菜单中的「编辑」「提前结束」「转为支线」选项

#### Scenario: 只读模式保留查看入口

**GIVEN** GoalDetailModal 以 isReadOnly=true 打开
**WHEN** 页面渲染
**THEN** 保留以下入口：
- 「记录」入口（查看历史打卡记录）
- 「计划」入口（查看周期计划）
- 周期进展信息展示
- 今日进度信息展示

---

### Requirement: 主线任务转支线任务

系统 **SHALL** 支持将主线任务转换为支线任务。

#### Scenario: 显示转为支线选项

**GIVEN** 用户打开主线任务（type='mainline'）的详情页
**WHEN** 点击右上角更多按钮
**THEN** 菜单中显示「转为支线」选项

#### Scenario: 支线任务不显示转换选项

**GIVEN** 用户打开支线任务的详情页
**WHEN** 点击右上角更多按钮
**THEN** 菜单中不显示「转为支线」选项

#### Scenario: 转换确认弹窗

**GIVEN** 用户点击「转为支线」选项
**WHEN** 弹窗打开
**THEN** 显示支线区域风格的确认弹窗
**And** 提示「将消耗 50 灵玉」
**And** 显示「确认」和「取消」按钮

#### Scenario: 确认转换

**GIVEN** 用户在确认弹窗点击「确认」
**WHEN** 用户灵玉余额 >= 50
**THEN**
- 扣除 50 灵玉
- 任务 type 改为 'sidelineA'
- 保留所有其他数据（周期、进度等）
- 关闭详情页
- 显示成功 Toast

#### Scenario: 转换灵玉不足

**GIVEN** 用户在确认弹窗点击「确认」
**WHEN** 用户灵玉余额 < 50
**THEN** 显示灵玉不足提示弹窗
**And** 不执行转换
