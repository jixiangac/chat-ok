# Proposal: 支线任务视图增强

## 概述

本提案旨在增强支线任务的功能和用户体验，包括：
1. 滚动条优化 - 只在 Tab 内容区域显示滚动条 (路径在：/pages/dc/index.tsx)
2. 今日必须完成任务功能 - 每日设置当天必须完成的支线任务
3. 支线任务编辑功能 - 支持修改任务名称和标签
4. 标签功能 - 为支线任务添加标签分类
5. Group 模式 - 按标签分组显示支线任务

## 动机

当前支线任务视图存在以下问题：
- 多个滚动条同时出现，影响用户体验
- 无法突出当天需要重点完成的任务
- 任务创建后无法编辑
- 任务数量多时缺乏有效的分类管理方式

## 变更范围

### 1. 显示优化
- **滚动条优化**: 修改 CSS 样式，确保滚动条只出现在 Tab 对应的内容区域

### 2. 今日必须完成任务功能
- **触发时机**: 每日8点后首次打开应用自动弹出设置弹窗
- **弹窗设计**: 
  - 顶部卡片图片元素
  - 上部分：两行横向滚动的任务选择列表
  - 下部分：已选择的任务（可删除）
  - 最多选择3个任务
- **任务来源**: 所有未完成的支线任务
- **跳过逻辑**: 跳过后当天不再提醒
- **置顶逻辑**: 设置后当天置顶显示，完成后取消置顶
- **跨天处理**: 第二天自动取消"今日必须完成"状态
- **设置入口**: 如果当天还没有设置过，可以在设置面板中手动打开设置弹窗

### 3. 支线任务编辑功能
- **编辑入口**: 详情页（已有入口，需实现功能）
- **可编辑字段**: 标签、名字

### 4. 标签功能
- **标签创建**: 用户可自由创建标签
- **标签来源**: 已有任务的标签（推荐）+ 用户新建
- **标签数量**: 每个任务只能设置1个标签
- **标签颜色**: 系统自动分配颜色

### 5. Group 模式
- **切换入口**: 支线任务标题右边的图标
- **显示条件**: 只有存在带标签的任务时才显示切换图标
- **卡片内容**: 标签名 + 进度 + 图标
- **进度计算**: 根据该标签下所有子任务的完成情况计算
- **点击行为**: 弹出小弹窗，显示该标签下任务的网格视图
- **无标签处理**: 不显示切换图标；删除所有标签后自动切换回默认模式

## 数据存储

- 存储方式: localStorage 本地存储
- 不需要多设备同步

## 影响范围

### 文件变更
- `src/pages/dc/types.ts` - 添加标签相关类型定义
- `src/pages/dc/css/DCPage.module.css` - 滚动条样式优化
- `src/pages/dc/panels/normal/index.tsx` - 添加 Group 模式切换
- `src/pages/dc/components/SidelineTaskGrid/index.tsx` - 支持 Group 模式
- `src/pages/dc/panels/detail/index.tsx` - 实现编辑功能
- 新增组件：
  - `TodayMustCompleteModal` - 今日必须完成任务设置弹窗
  - `SidelineTaskEditModal` - 支线任务编辑弹窗
  - `TagSelector` - 标签选择器组件
  - `GroupModeGrid` - Group 模式网格组件

### 新增存储键
- `dc_today_must_complete` - 今日必须完成任务状态
- `dc_task_tags` - 任务标签数据

## 风险评估

- **低风险**: 滚动条优化、编辑功能
- **中风险**: 标签功能、Group 模式（需要新增数据结构）
- **低风险**: 今日必须完成功能（独立功能，不影响现有逻辑）

## 验收标准

1. 滚动条只出现在 Tab 内容区域
2. 8点后首次打开应用能正确弹出今日必须完成设置弹窗
3. 可以正确选择、取消选择今日必须完成任务
4. 今日必须完成任务能正确置顶显示
5. 可以在详情页编辑任务名称和标签
6. 标签能正确创建、选择和显示
7. Group 模式能正确按标签分组显示
8. 无标签时不显示 Group 模式切换图标
